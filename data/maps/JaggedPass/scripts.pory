raw `
.set LOCALID_HIDEOUT_GUARD, 5

JaggedPass_MapScripts::
	map_script MAP_SCRIPT_ON_RESUME, JaggedPass_OnResume
	map_script MAP_SCRIPT_ON_TRANSITION, JaggedPass_OnTransition
	map_script MAP_SCRIPT_ON_LOAD, JaggedPass_OnLoad
	.byte 0

JaggedPass_OnResume:
	setstepcallback STEP_CB_ASH
	end

JaggedPass_EventScript_CheckHasMagmaEmblem::
	checkitem ITEM_MAGMA_EMBLEM
	goto_if_eq VAR_RESULT, TRUE, JaggedPass_EventScript_SetReadyToOpenHideout
	return

JaggedPass_EventScript_SetReadyToOpenHideout::
	setvar VAR_JAGGED_PASS_STATE, 1
	return

JaggedPass_EventScript_SetWeatherAsh::
	setweather WEATHER_VOLCANIC_ASH
	doweather
	return

JaggedPass_OnLoad:
	@goto_if_le VAR_JAGGED_PASS_STATE, 1, JaggedPass_EventScript_ConcealHideoutEntrance
	end

JaggedPass_EventScript_ConcealHideoutEntrance::
	setmetatile 16, 17, METATILE_Lavaridge_RockWall, TRUE
	setmetatile 16, 18, METATILE_Lavaridge_RockWall, TRUE
	end

JaggedPass_EventScript_OpenMagmaHideout::
	lockall
	setvar VAR_0x8004, 1  @ vertical pan
	setvar VAR_0x8005, 1  @ horizontal pan
	setvar VAR_0x8006, 8  @ num shakes
	setvar VAR_0x8007, 5  @ shake delay
	special ShakeCamera
	waitstate
	msgbox JaggedPass_Text_BoulderShakingInResponseToEmblem, MSGBOX_DEFAULT
	closemessage
	setvar VAR_0x8004, 1   @ vertical pan
	setvar VAR_0x8005, 1   @ horizontal pan
	setvar VAR_0x8006, 16  @ num shakes
	setvar VAR_0x8007, 3   @ shake delay
	special ShakeCamera
	waitstate
	playse SE_EFFECTIVE
	setmetatile 16, 17, METATILE_Lavaridge_CaveEntrance_Top, TRUE
	setmetatile 16, 18, METATILE_Lavaridge_CaveEntrance_Bottom, FALSE
	special DrawWholeMapView
	delay 30
	setvar VAR_JAGGED_PASS_STATE, 2
	waitse
	releaseall
	end

JaggedPass_EventScript_MagmaHideoutGuard::
	lockall
	goto_if_set FLAG_BEAT_MAGMA_GRUNT_JAGGED_PASS, JaggedPass_EventScript_GuardDefeated
	waitse
	playse SE_PIN
	applymovement LOCALID_HIDEOUT_GUARD, Common_Movement_ExclamationMark
	waitmovement 0
	applymovement LOCALID_HIDEOUT_GUARD, Common_Movement_Delay48
	waitmovement 0
	applymovement LOCALID_HIDEOUT_GUARD, Common_Movement_FacePlayer
	waitmovement 0
	msgbox JaggedPass_Text_GruntIntro, MSGBOX_DEFAULT
	closemessage
	trainerbattle_no_intro TRAINER_GRUNT_JAGGED_PASS, JaggedPass_Text_GruntDefeat
	setflag FLAG_BEAT_MAGMA_GRUNT_JAGGED_PASS
	applymovement LOCALID_HIDEOUT_GUARD, Common_Movement_FaceOriginalDirection
	waitmovement 0
	releaseall
	end

JaggedPass_EventScript_GuardDefeated::
	applymovement LOCALID_HIDEOUT_GUARD, Common_Movement_FacePlayer
	waitmovement 0
	msgbox JaggedPass_Text_GoWhereverYouWant, MSGBOX_DEFAULT
	closemessage
	applymovement LOCALID_HIDEOUT_GUARD, Common_Movement_FaceOriginalDirection
	waitmovement 0
	releaseall
	end

JaggedPass_EventScript_Eric::
	trainerbattle_single TRAINER_ERIC, JaggedPass_Text_EricIntro, JaggedPass_Text_EricDefeat
	msgbox JaggedPass_Text_EricPostBattle, MSGBOX_AUTOCLOSE
	end

JaggedPass_EventScript_Diana::
	trainerbattle_single TRAINER_DIANA_1, JaggedPass_Text_DianaIntro, JaggedPass_Text_DianaDefeat, JaggedPass_EventScript_RegisterDiana
	specialvar VAR_RESULT, ShouldTryRematchBattle
	goto_if_eq VAR_RESULT, TRUE, JaggedPass_EventScript_DianaRematch
	msgbox JaggedPass_Text_DianaPostBattle, MSGBOX_DEFAULT
	release
	end

JaggedPass_EventScript_RegisterDiana::
	special PlayerFaceTrainerAfterBattle
	msgbox JaggedPass_Text_DianaRegister, MSGBOX_DEFAULT
	register_matchcall TRAINER_DIANA_1
	release
	end

JaggedPass_EventScript_DianaRematch::
	trainerbattle_rematch TRAINER_DIANA_1, JaggedPass_Text_DianaRematchIntro, JaggedPass_Text_DianaRematchDefeat
	msgbox JaggedPass_Text_DianaPostRematch, MSGBOX_AUTOCLOSE
	end

JaggedPass_EventScript_Ethan::
	trainerbattle_single TRAINER_ETHAN_1, JaggedPass_Text_EthanIntro, JaggedPass_Text_EthanDefeat, JaggedPass_EventScript_RegisterEthan
	specialvar VAR_RESULT, ShouldTryRematchBattle
	goto_if_eq VAR_RESULT, TRUE, JaggedPass_EventScript_EthanRematch
	msgbox JaggedPass_Text_EthanPostBattle, MSGBOX_DEFAULT
	release
	end

JaggedPass_EventScript_RegisterEthan::
	special PlayerFaceTrainerAfterBattle
	msgbox JaggedPass_Text_EthanRegister, MSGBOX_DEFAULT
	register_matchcall TRAINER_ETHAN_1
	release
	end

JaggedPass_EventScript_EthanRematch::
	trainerbattle_rematch TRAINER_ETHAN_1, JaggedPass_Text_EthanRematchIntro, JaggedPass_Text_EthanRematchDefeat
	msgbox JaggedPass_Text_EthanPostRematch, MSGBOX_AUTOCLOSE
	end

JaggedPass_EventScript_Julio::
	trainerbattle_single TRAINER_JULIO, JaggedPass_Text_JulioIntro, JaggedPass_Text_JulioDefeat
	msgbox JaggedPass_Text_JulioPostBattle, MSGBOX_AUTOCLOSE
	end

JaggedPass_EventScript_Autumn::
	trainerbattle_single TRAINER_AUTUMN, JaggedPass_Text_AutumnIntro, JaggedPass_Text_AutumnDefeat
	msgbox JaggedPass_Text_AutumnPostBattle, MSGBOX_AUTOCLOSE
	end

JaggedPass_Text_EricIntro:
	.string "MT. CHIMNEY's JAGGED PASS…\p"
	.string "Now this is what I've always wanted\n"
	.string "in a mountain.\p"
	.string "This jagged bumpiness…\n"
	.string "It rocks my soul!$"

JaggedPass_Text_EricDefeat:
	.string "Losing left me bitter!$"

JaggedPass_Text_EricPostBattle:
	.string "Yes, I did lose at POKéMON…\p"
	.string "But, when it comes to the love of\n"
	.string "the mountains, I have you beat!$"

JaggedPass_Text_DianaIntro:
	.string "This place isn't your casual hike.\n"
	.string "It's not suited for a picnic.$"

JaggedPass_Text_DianaDefeat:
	.string "Ohhh, no!\n"
	.string "The ground is too bumpy…$"

JaggedPass_Text_DianaPostBattle:
	.string "Did you know?\p"
	.string "Some people cleverly ride their\n"
	.string "bicycles up this horribly bumpy pass.$"

JaggedPass_Text_DianaRegister:
	.string "Will you ever be back in this area?\n"
	.string "If you do return, I'd like a rematch.$"

JaggedPass_Text_DianaRematchIntro:
	.string "Picnics are fun wherever you go.\n"
	.string "Just like POKéMON!$"

JaggedPass_Text_DianaRematchDefeat:
	.string "I only lost because the ground is\n"
	.string "too bumpy!$"

JaggedPass_Text_DianaPostRematch:
	.string "I'll forget about losing and just\n"
	.string "enjoy this bumpy hike.$"

JaggedPass_Text_EthanIntro:
	.string "JAGGED PASS is hard to walk on.\n"
	.string "It's a good place for training.$"

JaggedPass_Text_EthanDefeat:
	.string "It was all over while we were still\n"
	.string "trying to find a good footing…$"

JaggedPass_Text_EthanPostBattle:
	.string "If I had an ACRO BIKE, I'd be able to\n"
	.string "jump ledges.$"

JaggedPass_Text_EthanRegister:
	.string "When I get more used to this bumpiness,\n"
	.string "I'll be sure to win!\p"
	.string "Can you register me in your POKéNAV?$"

JaggedPass_Text_EthanRematchIntro:
	.string "I got used to this bumpiness.\n"
	.string "I sing while I climb now.$"

JaggedPass_Text_EthanRematchDefeat:
	.string "It's still not easy to battle on this\n"
	.string "bumpy ground…$"

JaggedPass_Text_EthanPostRematch:
	.string "I should get an ACRO BIKE from RYDEL\n"
	.string "in MAUVILLE CITY…$"

JaggedPass_Text_GruntIntro:
	.string "Wah!\n"
	.string "What are you doing here?\p"
	.string "What am I doing in a place like this?\p"
	.string "What business is it of yours?$"

JaggedPass_Text_GruntDefeat:
	.string "Urrrgh…\p"
	.string "I should've ducked into our HIDEOUT\n"
	.string "right away…$"

JaggedPass_Text_GoWhereverYouWant:
	.string "Okay, oh-kay!\n"
	.string "I admit it--you're strong!\p"
	.string "Don't worry about me.\n"
	.string "Go wherever you want!$"

JaggedPass_Text_BoulderShakingInResponseToEmblem:
	.string "Oh! This boulder is shaking in response\n"
	.string "to the MAGMA EMBLEM!$"

JaggedPass_Text_JulioIntro:
	.string "Aiyeeh! It's awfully scary to shoot\n"
	.string "down the mountain in one go!$"

JaggedPass_Text_JulioDefeat:
	.string "I feel like I'm falling apart…$"

JaggedPass_Text_JulioPostBattle:
	.string "My bicycle bounced around so much,\n"
	.string "my rear end's sore…$"

JaggedPass_Text_AutumnIntro:
	.string "I climb this hill every day.\n"
	.string "I have confidence in my strength!$"

JaggedPass_Text_AutumnDefeat:
	.string "Hmm…\n"
	.string "What went wrong?$"

JaggedPass_Text_AutumnPostBattle:
	.string "What is that odd rock protrusion\n"
	.string "a little up the hill from here?$"
`

const LOCALID_RUTH = 14
const LOCALID_RUTHS_MON = 15
const LOCALID_POOCHYENA = 13
const LOCALID_MAGMA_GRUNT_W_POOCHYENA = 12
const LOCALID_RUNNING_POOCHYENA = 21
const LOCALID_MAY = 22
const LOCALID_MAGMA_ADMIN = 23
const LOCALID_FLANNERY = 24
const LOCALID_MAGMA_GRUNT_1 = 28
const LOCALID_MAGMA_GRUNT_2 = 29
const LOCALID_FOOTPRINT_NERD = 8
const FLAG_TEMP_HIDE_RUTHS_MON = FLAG_TEMP_10
const FLAG_TEMP_HIDE_RUTH = FLAG_TEMP_9
const FLAG_TEMP_HIDE_FLANNERY = FLAG_TEMP_8
const FLAG_TEMP_HIDE_RUNNING_POOCHYENA = FLAG_TEMP_7
const FLAG_TEMP_HIDE_FOOTPRINT_MANIAC_BLOCKING_NORTH_EXIT = FLAG_TEMP_6
const VAR_TEMP_DISABLE_MAY_CUTSCENE_TRIGGER = VAR_TEMP_1

script JaggedPass_EventScript_FootprintNerd {
	//stopping player from progressing to Fallarbor until second badge
	if (var(VAR_JAGGED_PASS_STATE) <= 3) { 
		lock
		applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
		waitmovement(0)
		speakername("Gunther")
		msgbox(format("Hello! You!\pTake a look at these fascinating Pokémon footprints here!"))
		closemessage
		applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_WalkInPlaceUp)
		applymovement(OBJ_EVENT_ID_PLAYER, JaggedPass_Movement_PlayerWalkUpToAsh)
		waitmovement(0)
		speakername("Gunther")
		msgbox(JaggedPass_Text_FootprintNerdWannaKnowWhatHappendHere, MSGBOX_YESNO)
		if (var(VAR_RESULT) == YES) {
			applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_WalkInPlaceUp)
			waitmovement(0)
			msgbox(JaggedPass_Text_FootprintNerdStory)
			applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
			turnobject(OBJ_EVENT_ID_PLAYER, DIR_WEST)
			msgbox(JaggedPass_Text_FootprintNerdNeedToStudy_1)
		}
		else {
			applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
			turnobject(OBJ_EVENT_ID_PLAYER, DIR_WEST)
			msgbox(JaggedPass_Text_FootprintNerdNeedToStudy_2)
		}
		closemessage
		applymovement(OBJ_EVENT_ID_PLAYER, Common_Movement_WalkDown)
		turnobject(LOCALID_FOOTPRINT_NERD, DIR_NORTH)
		waitmovement(0)
		release
		end
	}
	//footprint minigame TODO
	else {
	lock
	faceplayer
	specialvar(VAR_RESULT, ScriptGetPokedexInfo)
	copyvar(VAR_0x8008, VAR_0x8005)
	copyvar(VAR_0x8009, VAR_0x8006)
	copyvar (VAR_0x800A, VAR_RESULT)
	buffernumberstring(STR_VAR_1, VAR_0x8008)  // Num Hoenn seen
	buffernumberstring(STR_VAR_2, VAR_0x8009)  // Num Hoenn caught
	if (var(VAR_0x8009) < 15) {
		msgbox(format("There's lots of footprints in the ash here!\p"
			"I'm trying to figure out which Pokémon they belong to.\p"
			"Maybe I'll let you have a guess when you filled out that PokéDex of yours a little more."), MSGBOX_AUTOCLOSE)
		release
		end
	}
	msgbox(format("There's lots of footprints in the ash here!\p"
		"I'm trying to figure out which Pokémon they belong to.\p"
		"Are you good with Pokémon footprints?"), MSGBOX_YESNO)
	if (var(VAR_RESULT) == YES) {
		msgbox(format("I knew you were a fellow footprint enthusiast!\p"
			"Let Jojo know she needs to find out how to display footprints and we'll start!"), MSGBOX_AUTOCLOSE)
	}
	else {
		msgbox(format("No? That's too bad, I'd have given you an item if you got them right."), MSGBOX_AUTOCLOSE)
	}
	release
	end
	}
}

script JaggedPass_EventScript_MachBikeTriathlete {
	msgbox(format("Hmmmm, my Mach Bike isn't suited for this kind of terrain…\p"
		"If I had an Acro Bike, I could get up these rocks and maybe get to the top of the mountain…"), MSGBOX_NPC)
	end
}

script JaggedPass_EventScript_HeadbuttTreeMan {
	msgbox(format("Pokémon like to hide in large trees like this!\p"
		"I bet a Pokémon that knows the move Headbutt could knock them out of the branches."), MSGBOX_NPC)
	applymovement(VAR_LAST_TALKED, Common_Movement_FaceOriginalDirection)
	end
}

script JaggedPass_EventScript_Ruth {
	switch (var(VAR_JAGGED_PASS_STATE)) {
		case 0:
		case 1:
		case 2:
			faceplayer
			speakername(CommonName_Ruth)
			msgbox(format("Grr! He won't let me through!\p{PLAYER}, go ahead, I'll catch up once I beat this guy!"))
			turnobject(VAR_LAST_TALKED, DIR_WEST)
			switch(var(VAR_STARTER_MON)) {
				case 0:
					bufferspeciesname(STR_VAR_1, SPECIES_RUBECKO)
					msgbox(JaggedPass_Text_GetHim)
					applymovement(LOCALID_RUTHS_MON, JaggedPass_Movement_JumpInPlaceLeftTwice)
					call(JaggedPass_EventScript_Rubecko)
				case 1:
					bufferspeciesname(STR_VAR_1, SPECIES_AMALGOAT)
					msgbox(JaggedPass_Text_GetHim)
					applymovement(LOCALID_RUTHS_MON, JaggedPass_Movement_JumpInPlaceLeftTwice)
					call(JaggedPass_EventScript_Amalgoat)
				case 2:
					bufferspeciesname(STR_VAR_1, SPECIES_TOXATOO)
					msgbox(JaggedPass_Text_GetHim)
					applymovement(LOCALID_RUTHS_MON, JaggedPass_Movement_JumpInPlaceLeftTwice_NoGroundEffect)
					call(JaggedPass_EventScript_Toxatoo)
			}
			closemessage
			release
			end
		case 3:
			lock
			faceplayer
			speakername(CommonName_Ruth)
			switch (var(VAR_STARTER_MON)) {
				case 0:
				case 2:
					msgbox(format("Hey, {PLAYER}!\pMy Barboach is starting to catch up!\pJust a little bit more…\p"
					"Oh, by the way! Do you see that large tree there?\pThat man over there said you can knock Pokémon out of the branches.\p"
					"Argh, I wish one of my Pokémon knew the move Headbutt!\pI want to check out what lives up there…"))
				case 1:
					msgbox(format("Hey, {PLAYER}!\pMy Barboach is starting to catch up!\pJust a little bit more…\p"
					"Oh, by the way! Do you see that large tree there?\pMy Amalgoat knocked a little Seedot out of the branches!\p"
					"Do you have a Pokémon that knows the move Headbutt?\pYou should really try it out!"))
			}
			closemessage
			release
			end
	}
	
}

script JaggedPass_EventScript_RuthsMon {
	switch(var(VAR_STARTER_MON)){
		case 0:
			call(JaggedPass_EventScript_Rubecko)
		case 1:
			call(JaggedPass_EventScript_Amalgoat)
		case 2:
			call(JaggedPass_EventScript_Toxatoo)
	}
	closemessage
	release
	end
}

script JaggedPass_EventScript_GruntTryStopPlayer1_T {
	lock
	playse(SE_PIN)
	applymovement(LOCALID_MAGMA_GRUNT_W_POOCHYENA, Common_Movement_ExclamationMarkAndDelay)
	waitmovement(0)
	speakername(CommonName_MagmaGrunt)
	msgbox(JaggedPass_Text_PoochyenaGetThem)
	closemessage
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaApprachPlayer_T)
	waitmovement(0)
	playmoncry(SPECIES_POOCHYENA, CRY_MODE_NORMAL)
	waitmoncry
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaJumpAtPlayer)
	delay(4)
	applymovement(OBJ_EVENT_ID_PLAYER, JaggedPass_Movement_PlayerStumbleBackwards)
	waitmovement(LOCALID_POOCHYENA)
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaRetreat_T)
	waitmovement(0)
	release
	end
}

script JaggedPass_EventScript_GruntTryStopPlayer1_C {
	lock
	playse(SE_PIN)
	applymovement(LOCALID_MAGMA_GRUNT_W_POOCHYENA, Common_Movement_ExclamationMarkAndDelay)
	waitmovement(0)
	speakername(CommonName_MagmaGrunt)
	msgbox(JaggedPass_Text_PoochyenaGetThem)
	closemessage
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaApprachPlayer_C)
	waitmovement(0)
	playmoncry(SPECIES_POOCHYENA, CRY_MODE_NORMAL)
	waitmoncry
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaJumpAtPlayer)
	delay(4)
	applymovement(OBJ_EVENT_ID_PLAYER, JaggedPass_Movement_PlayerStumbleBackwards)
	waitmovement(LOCALID_POOCHYENA)
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaRetreat_C)
	waitmovement(0)
	release
	end
}

script JaggedPass_EventScript_GruntTryStopPlayer1_B {
	lock
	playse(SE_PIN)
	applymovement(LOCALID_MAGMA_GRUNT_W_POOCHYENA, Common_Movement_ExclamationMarkAndDelay)
	waitmovement(0)
	speakername(CommonName_MagmaGrunt)
	msgbox(JaggedPass_Text_PoochyenaGetThem)
	closemessage
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaApprachPlayer_B)
	waitmovement(0)
	playmoncry(SPECIES_POOCHYENA, CRY_MODE_NORMAL)
	waitmoncry
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaJumpAtPlayer)
	delay(4)
	applymovement(OBJ_EVENT_ID_PLAYER, JaggedPass_Movement_PlayerStumbleBackwards)
	waitmovement(LOCALID_POOCHYENA)
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_PoochyenaRetreat_B)
	waitmovement(0)
	release
	end
}

script JaggedPass_EventScript_GruntTryStopPlayer2 {
	applymovement(LOCALID_MAGMA_GRUNT_W_POOCHYENA, Common_Movement_FacePlayer)
	speakername(CommonName_MagmaGrunt)
	msgbox(format("Hey! You can't-"))
	closemessage
	applymovement(LOCALID_MAGMA_GRUNT_W_POOCHYENA, Common_Movement_FaceOriginalDirection)
	switch(var(VAR_STARTER_MON)){
		case 0:
			applymovement(LOCALID_RUTHS_MON, JaggedPass_Movement_JumpInPlaceLeftTwice)
			playmoncry(SPECIES_RUBECKO, CRY_MODE_NORMAL)
		case 1:
			applymovement(LOCALID_RUTHS_MON, JaggedPass_Movement_JumpInPlaceLeftTwice)
			playmoncry(SPECIES_AMALGOAT, CRY_MODE_NORMAL)
		case 2:
			applymovement(LOCALID_RUTHS_MON, JaggedPass_Movement_JumpInPlaceLeftTwice_NoGroundEffect)
			playmoncry(SPECIES_TOXATOO, CRY_MODE_NORMAL)
	}
	waitmovement(0)
	waitmoncry
	applymovement(LOCALID_POOCHYENA, JaggedPass_Movement_JumpInPlaceRightTwice)
	playmoncry(SPECIES_POOCHYENA, CRY_MODE_NORMAL)
	waitmovement(0)
	waitmoncry
	speakername(CommonName_MagmaGrunt)
	msgbox(format("Argh! This annoying little…!"))
	setvar(VAR_JAGGED_PASS_STATE, 2)
	release
	end
}

script JaggedPass_EventScript_Rubecko {
	speakername(CommonName_Rubecko)
	playmoncry(SPECIES_RUBECKO, CRY_MODE_NORMAL)
	msgbox(JaggedPass_Text_RubeckoCry)
	waitmoncry
}

script JaggedPass_EventScript_Amalgoat {
	speakername(CommonName_Amalgoat)
	playmoncry(SPECIES_AMALGOAT, CRY_MODE_NORMAL)
	msgbox(JaggedPass_Text_AmalgoatCry)
	waitmoncry
}

script JaggedPass_EventScript_Toxatoo {
	speakername(CommonName_Toxatoo)
	playmoncry(SPECIES_TOXATOO, CRY_MODE_NORMAL)
	msgbox(JaggedPass_Text_ToxatooCry)
	waitmoncry
}

script JaggedPass_EventScript_Poochyena {
	speakername(CommonName_Poochyena)
	playmoncry(SPECIES_POOCHYENA, CRY_MODE_NORMAL)
	msgbox(MtChimney_Text_Bufoh)
	waitmoncry
}

script JaggedPass_EventScript_GruntWithLostPoochyena {
	if (!flag(FLAG_TEMP_HIDE_RUNNING_POOCHYENA)) {
		speakername(CommonName_MagmaGrunt)
		applymovement(VAR_LAST_TALKED, Common_Movement_WalkInPlaceLeft)
		waitmovement(0)
		msgbox(format("Come back up here, Poochyena!\pWe've got things to do and stairs to guard!"))
		closemessage
		applymovement(LOCALID_RUNNING_POOCHYENA, JaggedPass_Movement_PoochyenaRunAway)
		playmoncry(SPECIES_POOCHYENA, CRY_MODE_NORMAL)
		waitmovement(0)
		speakername(CommonName_MagmaGrunt)
		msgbox(format("Wha-? Where are you going?!"))
		closemessage
		playmoncry(SPECIES_POOCHYENA, CRY_MODE_NORMAL)
		waitmoncry
		playmoncry(SPECIES_NUMEL, CRY_MODE_NORMAL)
		waitmoncry
		applymovement(VAR_LAST_TALKED, Common_Movement_WalkInPlaceLeft)
		waitmovement(0)
		speakername(CommonName_MagmaGrunt)
		msgbox(format("No! Leave that wild Numel alone! Bad girl!"))
		closemessage
		setflag(FLAG_TEMP_HIDE_RUNNING_POOCHYENA)
	}
	else {
		speakername(CommonName_MagmaGrunt)
		msgbox(format("What am I supposed to do now?\pI can't stand guard without my Poochyena!\pI should've trained the little rascal better…"))
		closemessage
	}
	release
	end
}

script JaggedPass_EventScript_MayScene {
	lock
	playbgm(MUS_ENCOUNTER_MAGMA, FALSE)
	applymovement(LOCALID_MAGMA_ADMIN, JaggedPass_Movement_TabithaWalkBackwards)
	waitmovement(0)
	speakername(CommonName_Tabitha)
	msgbox(format("Ugh… You're as strong as ever."))
	closemessage
	applymovement(LOCALID_MAY, Common_Movement_WalkInPlaceRight)
	waitmovement(0)
	speakername(CommonName_May)
	msgbox(format("I'm sorry, but this cave is off-limits.\pIt's not safe, there's been cave-ins all over the place."))
	closemessage
	applymovement(LOCALID_MAGMA_ADMIN, Common_Movement_WalkLeft)
	waitmovement(0)
	speakername(CommonName_Tabitha)
	msgbox(format("Spare me the sarcasm, girl.\p"
			"We both know the real reason why you're trying to stop us from entering our old hideout.\p"
			"But it doesn't matter, we'll get in there one way or another.\p"
			"Don't think for a second you can keep us away just because you're a gym leader now."))
	closemessage
	applymovement(LOCALID_MAGMA_ADMIN, JaggedPass_Movement_TabithaWalkAway)
	applymovement(LOCALID_MAGMA_GRUNT_1, JaggedPass_Movement_Grunt1WalkAway)
	applymovement(LOCALID_MAGMA_GRUNT_2, JaggedPass_Movement_Grunt2WalkAway)
	delay(64)
	fadedefaultbgm
	waitmovement(0)
	removeobject(LOCALID_MAGMA_GRUNT_1)
	removeobject(LOCALID_MAGMA_GRUNT_2)
	removeobject(LOCALID_MAGMA_ADMIN)
	delay(128)
	clearflag(FLAG_TEMP_HIDE_FLANNERY)
	addobject(LOCALID_FLANNERY)
	playse(SE_FU_ZAKU)
	waitse
	turnobject(LOCALID_MAY, DIR_NORTH)
	applymovement(LOCALID_FLANNERY, Common_Movement_WalkDown)
	waitmovement(0)
	speakername(CommonName_Flannery)
	msgbox(format("May!"))
	closemessage
	waitmovement(0)
	applymovement(LOCALID_MAY, Common_Movement_WalkInPlaceUp)
	waitmovement(0)
	speakername(CommonName_May)
	msgbox(format("So, how far did they get?"))
	closemessage
	applymovement(LOCALID_FLANNERY, Common_Movement_WalkInPlaceDown)
	waitmovement(0)
	speakername(CommonName_Flannery)
	msgbox(format("They cleared out a bunch, but the path's still blocked by boulders and debris."))
	closemessage 
	applymovement(LOCALID_MAY, Common_Movement_WalkInPlaceUp)
	waitmovement(0)
	speakername(CommonName_May)
	msgbox(format("That's good, at least…\pI'll have to see what I can do to close off the cave."))
	closemessage
	setobjectxyperm(LOCALID_RUTH, 36, 20)
	addobject(LOCALID_RUTH)
	applymovement(LOCALID_RUTH, JaggedPass_Movement_RuthApproachPlayer)
	waitmovement(0)
	speakername(CommonName_Ruth)
	msgbox(format("{PLAYER}, there you are!"))
	turnobject(OBJ_EVENT_ID_PLAYER, DIR_WEST)
	closemessage
	getplayerxy(VAR_0x8000, VAR_0x8001)
	switch(var(VAR_0x8001)) {
		case 19:
			applymovement(LOCALID_RUTH, JaggedPass_Movement_RuthApproachPlayer_T)
			waitmovement(0)
			turnobject(OBJ_EVENT_ID_PLAYER, DIR_SOUTH)
		case 20:
			applymovement(LOCALID_RUTH, JaggedPass_Movement_RuthApproachPlayer_C)
			waitmovement(0)
			turnobject(OBJ_EVENT_ID_PLAYER, DIR_NORTH)
		case 21:
			applymovement(LOCALID_RUTH, JaggedPass_Movement_RuthApproachPlayer_B)
			waitmovement(0)
			turnobject(OBJ_EVENT_ID_PLAYER, DIR_NORTH)
	}
	speakername(CommonName_Ruth)
	msgbox(format("Oh, and Flannery! And…\pUhm…"))
	closemessage
	turnobject(LOCALID_MAY, DIR_WEST)
	turnobject(LOCALID_FLANNERY, DIR_WEST)
	switch(var(VAR_0x8001)) {
		case 19:
			applymovement(LOCALID_MAY, JaggedPass_Movement_MayApproachPlayer_2)
		case 20:
		case 21:
			applymovement(LOCALID_MAY, JaggedPass_Movement_MayApproachPlayer_1)
	}
	waitmovement(0)
	turnobject(OBJ_EVENT_ID_PLAYER, DIR_EAST)
	speakername(CommonName_May)
	msgbox(format("The name's May!\pI took over Lavaridge Gym recently.\pAnd you are?"))
	closemessage
	switch(var(VAR_0x8001)) {
		case 19:
			applymovement(LOCALID_FLANNERY, JaggedPass_Movement_FlanneryApproachPlayer_2)
		case 20:
		case 21:
			applymovement(LOCALID_FLANNERY, JaggedPass_Movement_FlanneryApproachPlayer_1)
	}
	waitmovement(0)
	turnobject(LOCALID_MAY, DIR_NORTH)
	speakername(CommonName_Flannery)
	msgbox(format("This is my little cousin Ruth, and her friend {PLAYER}.\pThey came to earn themselves a shiny new badge."))
	applymovement(LOCALID_MAY, Common_Movement_WalkInPlaceLeft)
	waitmovement(0)
	turnobject(LOCALID_FLANNERY, DIR_WEST)
	speakername(CommonName_May)
	msgbox(format("Oh, I'm sorry I kept you waiting!\pWe can go back to Lavaridge immediately, if the two of you are ready."))
	closemessage
	applymovement(LOCALID_RUTH, JaggedPass_Movement_RuthUnsure)
	waitmovement(0)
	speakername(CommonName_Ruth)
	msgbox(format("Wait, right now?\pI… I think I'll stay here for a bit."))
	applymovement(LOCALID_RUTH, Common_Movement_FacePlayer)
	switch(var(VAR_0x8001)) {
		case 19:
			turnobject(OBJ_EVENT_ID_PLAYER, DIR_SOUTH)
		case 20:
		case 21:
			turnobject(OBJ_EVENT_ID_PLAYER, DIR_NORTH)
	}
	msgbox(format("{PLAYER}, as much as I want to get this badge before you, I don't think I should rush it right now.\p"
			"I'll take my time to build a strong foundation and catch up to you in no time!"))
	closemessage
	applymovement(LOCALID_RUTH, JaggedPass_Movement_RuthLeave)
	delay(16)
	turnobject(OBJ_EVENT_ID_PLAYER, DIR_WEST)
	waitmovement(0)
	removeobject(LOCALID_RUTH)
	applymovement(LOCALID_FLANNERY, Common_Movement_WalkInPlaceLeft)
	waitmovement(0)
	speakername(CommonName_Flannery)
	msgbox(format("Huh? What was that?\pMy little cousin… being reasonable?"))
	applymovement(LOCALID_FLANNERY, Common_Movement_WalkInPlaceDown)
	waitmovement(0)
	turnobject(OBJ_EVENT_ID_PLAYER, DIR_EAST)
	turnobject(LOCALID_MAY, DIR_NORTH)
	msgbox(format("Anyway, May, I think I have to go now.\pYou've got the situation under control?"))
	closemessage
	applymovement(LOCALID_MAY, Common_Movement_WalkInPlaceUp)
	waitmovement(0)
	speakername(CommonName_May)
	msgbox(format("Yes, thanks for your help, Flannery!"))
	closemessage
	applymovement(LOCALID_FLANNERY, JaggedPass_Movement_FlanneryLeave)
	delay(16)
	turnobject(LOCALID_MAY, DIR_EAST)
	waitmovement(0)
	speakername(CommonName_Flannery)
	msgbox(format("Next visit to the hot springs is on you, May!"))
	closemessage
	setfieldeffectargument(0, 1)
	playmoncry(SPECIES_MOLTRES, CRY_MODE_NORMAL)
	delay(16)
	dofieldeffect(FLDEFF_NPCFLY_OUT)
	delay(10)
	removeobject(LOCALID_FLANNERY)
	waitfieldeffect(FLDEFF_NPCFLY_OUT)
	delay(32)
	applymovement(LOCALID_MAY, Common_Movement_WalkInPlaceLeft)
	waitmovement(0)
	speakername(CommonName_May)
	msgbox(format("I'll be looking forward to our battle, {PLAYER}!"))
	closemessage
	switch(var(VAR_0x8001)) {
		case 19:
			applymovement(LOCALID_MAY, JaggedPass_Movement_MayLeave_2)
		case 20:
		case 21:
			applymovement(LOCALID_MAY, JaggedPass_Movement_MayLeave_1)
	}
	delay(16)
	turnobject(OBJ_EVENT_ID_PLAYER, DIR_SOUTH)
	waitmovement(0)
	removeobject(LOCALID_MAY)

	setvar(VAR_JAGGED_PASS_STATE, 3)
	setobjectxyperm(LOCALID_RUTH, 10, 33)
	addobject(LOCALID_RUTH)
	setobjectmovementtype(LOCALID_RUTH, MOVEMENT_TYPE_LOOK_AROUND)
	removeobject(LOCALID_RUTHS_MON)
	setflag(FLAG_HIDE_JAGGED_PASS_GRUNTS)
	setflag(FLAG_TEMP_HIDE_RUNNING_POOCHYENA)
	setflag(FLAG_HIDE_JAGGED_PASS_NPCS) //until left + re-entered, no NPCs here yet
	setflag(FLAG_LAVARIDGE_GYM_OPEN)
	setflag(FLAG_TEMP_HIDE_RUTHS_MON)
	special(DrawWholeMapView)
	release
	end
}

script JaggedPass_EventScript_FootprintNerdTryStopPlayer_L {
	lock
	applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
	waitmovement(0)
	playse(SE_PIN)
	applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_ExclamationMarkAndDelay)
	waitmovement(0)
	speakername("Gunther")
	msgbox(JaggedPass_Text_FootprintNerdHey)
	turnobject(OBJ_EVENT_ID_PLAYER, DIR_EAST)
	msgbox(JaggedPass_Text_FootprintNerdPerfectFootprints)
	applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_WalkInPlaceUp)
	waitmovement(0)
	msgbox(JaggedPass_Text_FootprintNerdWannaKnowWhatHappendHere, MSGBOX_YESNO)
	if (var(VAR_RESULT) == YES) {
		applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_WalkInPlaceUp)
		waitmovement(0)
		turnobject(OBJ_EVENT_ID_PLAYER, DIR_NORTH)
		msgbox(JaggedPass_Text_FootprintNerdStory)
		applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
		turnobject(OBJ_EVENT_ID_PLAYER, DIR_EAST)
		msgbox(JaggedPass_Text_FootprintNerdNeedToStudy_1)
	}
	else {
		applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
		turnobject(OBJ_EVENT_ID_PLAYER, DIR_EAST)
		msgbox(JaggedPass_Text_FootprintNerdNeedToStudy_2)
	}
	closemessage
	applymovement(OBJ_EVENT_ID_PLAYER, Common_Movement_WalkDown)
	turnobject(LOCALID_FOOTPRINT_NERD, DIR_NORTH)
	waitmovement(0)
	release
	end
}

script JaggedPass_EventScript_FootprintNerdTryStopPlayer_R {
	lock
	applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
	waitmovement(0)
	playse(SE_PIN)
	applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_ExclamationMarkAndDelay)
	waitmovement(0)
	speakername("Gunther")
	msgbox(JaggedPass_Text_FootprintNerdHey)
	turnobject(OBJ_EVENT_ID_PLAYER, DIR_WEST)
	msgbox(JaggedPass_Text_FootprintNerdPerfectFootprints)
	applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_WalkInPlaceUp)
	waitmovement(0)
	msgbox(JaggedPass_Text_FootprintNerdWannaKnowWhatHappendHere, MSGBOX_YESNO)
	if (var(VAR_RESULT) == YES) {
		applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_WalkInPlaceUp)
		waitmovement(0)
		turnobject(OBJ_EVENT_ID_PLAYER, DIR_NORTH)
		msgbox(JaggedPass_Text_FootprintNerdStory)
		applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
		turnobject(OBJ_EVENT_ID_PLAYER, DIR_WEST)
		msgbox(JaggedPass_Text_FootprintNerdNeedToStudy_1)
	}
	else {
		applymovement(LOCALID_FOOTPRINT_NERD, Common_Movement_FacePlayer)
		turnobject(OBJ_EVENT_ID_PLAYER, DIR_WEST)
		msgbox(JaggedPass_Text_FootprintNerdNeedToStudy_2)
	}
	closemessage
	applymovement(OBJ_EVENT_ID_PLAYER, Common_Movement_WalkDown)
	turnobject(LOCALID_FOOTPRINT_NERD, DIR_NORTH)
	waitmovement(0)
	release
	end
}

text JaggedPass_Text_FootprintNerdHey {
	format("Hey!\pHey hey!")
}

text JaggedPass_Text_FootprintNerdPerfectFootprints {
	format("You didn't intend to step on this ash, right?\p"
		"Just take a look at those perfect Pokémon footprints!")
}

text JaggedPass_Text_FootprintNerdWannaKnowWhatHappendHere {
	format("What a specimen!\pJust a look at them and I can see the scene it in front of my eyes!\p"
		"Want to know what happened here?")
}

text JaggedPass_Text_FootprintNerdStory {
	format("These tracks belong to a young Numel, snoozing in the volcanic ash, when suddenly…\p"
			"Bam!\p"
			"A Poochyena attacks! Completely out of nowhere!\p"
			"The Numel, disoriented, gets up and tries to run away.\p"
			"The Poochyena prepares a second attack…\p"
			"But it gets distracted by something else and runs off.")
}

text JaggedPass_Text_FootprintNerdNeedToStudy_1 {
	format("Fascinating, isn't it?\pI'll have to study these more!\p"
			"I'll have to ask you not to step on this patch of ash until I'm done, though.\pSorry.")
}

text JaggedPass_Text_FootprintNerdNeedToStudy_2 {
	format("Still, I have to study these!\p"
			"I'll have to ask you not to step on this patch of ash until I'm done.\pSorry.")
}

text JaggedPass_Text_GetHim {
	"Get him, {STR_VAR_1}!"
}

text JaggedPass_Text_RubeckoCry {
	"Ribbit!"
}

text JaggedPass_Text_AmalgoatCry {
	"Maaaaaah!"
}

text JaggedPass_Text_ToxatooCry {
	"Too! Tootoo!"
}

text JaggedPass_Text_PoochyenaGetThem {
	format("Hey! You can't go here!\pPoochyena, get them!")
}

movement JaggedPass_Movement_JumpInPlaceLeftTwice {
	jump_in_place_left
	jump_in_place_left
}

movement JaggedPass_Movement_JumpInPlaceRightTwice {
	jump_in_place_right
	jump_in_place_right
}

movement JaggedPass_Movement_PoochyenaRunAway {
	jump_in_place_right
	jump_in_place_right
	delay_16
	walk_fast_left *6
}

movement JaggedPass_Movement_PoochyenaApprachPlayer_T {
	walk_fast_up
	walk_fast_right
}

movement JaggedPass_Movement_PoochyenaApprachPlayer_C {
	walk_fast_right
}

movement JaggedPass_Movement_PoochyenaApprachPlayer_B {
	walk_fast_down
	walk_fast_right
}

movement JaggedPass_Movement_PoochyenaJumpAtPlayer {
	jump_right
	delay_16
}

movement JaggedPass_Movement_PlayerStumbleBackwards {
	lock_facing_direction
	walk_faster_right
	unlock_facing_direction
}

movement JaggedPass_Movement_PoochyenaRetreat_T {
	walk_fast_left *2
	walk_fast_down
	face_right
}

movement JaggedPass_Movement_PoochyenaRetreat_C {
	walk_fast_left *2
	face_right
}

movement JaggedPass_Movement_PoochyenaRetreat_B {
	walk_fast_left *2
	walk_fast_up
	face_right
}

movement JaggedPass_Movement_TabithaWalkBackwards {
	lock_facing_direction
	walk_right
	unlock_facing_direction
}

movement JaggedPass_Movement_TabithaWalkAway {
	walk_up
	walk_right *5
}

movement JaggedPass_Movement_Grunt1WalkAway {
	delay_16 *3
	walk_up
	walk_right*3
}

movement JaggedPass_Movement_Grunt2WalkAway {
	delay_16 *3
	walk_up *2
	walk_right*3
}

movement JaggedPass_Movement_RuthApproachPlayer {
	walk_right*6
}

movement JaggedPass_Movement_RuthApproachPlayer_T {
	walk_right*2
}

movement JaggedPass_Movement_RuthApproachPlayer_C {
	walk_up
	walk_right*2
}

movement JaggedPass_Movement_RuthApproachPlayer_B {
	walk_right*2
}

movement JaggedPass_Movement_RuthLeave {
	walk_left *8
}

movement JaggedPass_Movement_FlanneryApproachPlayer_1 {
	walk_left
	walk_in_place_down
}

movement JaggedPass_Movement_FlanneryApproachPlayer_2 {
	walk_left
	walk_down
}

movement JaggedPass_Movement_MayApproachPlayer_1 {
	walk_left
}

movement JaggedPass_Movement_MayApproachPlayer_2 {
	walk_down
	walk_left
}

movement JaggedPass_Movement_FlanneryLeave {
	walk_right
	walk_down
	walk_right
	delay_8
	walk_in_place_left
}

movement JaggedPass_Movement_MayLeave_1 {
	walk_down*2
	jump_down
	walk_down*2
}

movement JaggedPass_Movement_MayLeave_2 {
	walk_down
	jump_down
	walk_down*3
}

movement JaggedPass_Movement_RuthUnsure {
	delay_16
	face_player
	delay_16
	face_right
}

movement JaggedPass_Movement_PlayerWalkUpToAsh {
	walk_right
	walk_up
}

movement JaggedPass_Movement_JumpInPlaceLeftTwice_NoGroundEffect {
	disable_jump_landing_ground_effect
	jump_in_place_left
	disable_jump_landing_ground_effect
	jump_in_place_left
}

script JaggedPass_OnTransition {
	switch (var(VAR_JAGGED_PASS_STATE)) {
		case 0: //grunts there, ruth not there
			setflag(FLAG_HIDE_JAGGED_PASS_NPCS)
			clearflag(FLAG_HIDE_JAGGED_PASS_GRUNTS)
			setobjectmovementtype(LOCALID_POOCHYENA, MOVEMENT_TYPE_FACE_RIGHT)
			setflag(FLAG_TEMP_HIDE_RUTH)
			setflag(FLAG_TEMP_HIDE_RUTHS_MON)
		case 1: //grunts there, ruth there
		case 2: //after grunt has tried to prevent player from moving past
			setflag(FLAG_HIDE_JAGGED_PASS_NPCS)
			clearflag(FLAG_HIDE_JAGGED_PASS_GRUNTS)
			setobjectmovementtype(LOCALID_POOCHYENA, MOVEMENT_TYPE_FACE_RIGHT)
			clearflag(FLAG_TEMP_HIDE_RUTH)
			clearflag(FLAG_TEMP_HIDE_RUTHS_MON)
			switch (var(VAR_STARTER_MON)) {
			case 0:
				setvar(VAR_OBJ_GFX_ID_0, OBJ_EVENT_GFX_SPECIES(RUBECKO))
			case 1:
				setvar(VAR_OBJ_GFX_ID_0, OBJ_EVENT_GFX_SPECIES(AMALGOAT))
			case 2:
				setvar(VAR_OBJ_GFX_ID_0, OBJ_EVENT_GFX_SPECIES(TOXATOO))
			}
		case 3: //after cutscene with may, flannery and tabitha; ruth is training
			setflag(FLAG_HIDE_JAGGED_PASS_GRUNTS)
			clearflag(FLAG_HIDE_JAGGED_PASS_NPCS)
			clearflag(FLAG_TEMP_HIDE_RUTH)
			setflag(FLAG_TEMP_HIDE_RUTHS_MON)
			setobjectxyperm(LOCALID_RUTH, 10, 33)
			setobjectmovementtype(LOCALID_RUTH, MOVEMENT_TYPE_LOOK_AROUND)
			setflag(FLAG_TEMP_HIDE_RUNNING_POOCHYENA)
		case 4: //after some story event tba, ruth is not training here anymore and footprint nerd does not block north exit anymore
			setflag(FLAG_HIDE_JAGGED_PASS_GRUNTS)
			clearflag(FLAG_HIDE_JAGGED_PASS_NPCS)
			setflag(FLAG_TEMP_HIDE_RUTH)
			setflag(FLAG_TEMP_HIDE_RUTHS_MON)
			setflag(FLAG_TEMP_HIDE_RUNNING_POOCHYENA)
			setobjectxyperm(LOCALID_FOOTPRINT_NERD, 14, 11)
			setobjectmovementtype(LOCALID_FOOTPRINT_NERD, MOVEMENT_TYPE_LOOK_AROUND)
	}
	setflag(FLAG_TEMP_HIDE_FLANNERY)
	

	if (flag(FLAG_LAVARIDGE_GYM_OPEN) && !flag(FLAG_BADGE04_GET)) {
		clearflag(FLAG_TEMP_HIDE_FOOTPRINT_MANIAC_BLOCKING_NORTH_EXIT)
		setvar(VAR_TEMP_0, 3)
	}
	elif (flag(FLAG_LAVARIDGE_GYM_OPEN) && flag(FLAG_BADGE04_GET)) {
		setflag(FLAG_TEMP_HIDE_FOOTPRINT_MANIAC_BLOCKING_NORTH_EXIT)
	}

}