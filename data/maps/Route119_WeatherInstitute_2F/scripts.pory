raw `
Route119_WeatherInstitute_2F_MapScripts::
	map_script MAP_SCRIPT_ON_TRANSITION, Route119_WeatherInstitute_2F_OnTransition
	.byte 0

Route119_WeatherInstitute_2F_EventScript_ScientistMentionWeather::
	goto_if_set FLAG_SYS_GAME_CLEAR, Route119_WeatherInstitute_2F_EventScript_TryStartAbnormalWeather
	msgbox Route119_WeatherInstitute_2F_Text_ChangingWeatherRidiculous, MSGBOX_DEFAULT
	release
	end

Route119_WeatherInstitute_2F_EventScript_TryStartAbnormalWeather::
	setvar VAR_0x8004, 0
	call_if_set FLAG_DEFEATED_KYOGRE, Route119_WeatherInstitute_2F_EventScript_LegendaryDefeated
	call_if_set FLAG_DEFEATED_GROUDON, Route119_WeatherInstitute_2F_EventScript_LegendaryDefeated
	goto_if_eq VAR_0x8004, 2, Route119_WeatherInstitute_2F_EventScript_NoAbnormalWeather  @ Both defeated
	call_if_unset FLAG_TEMP_2, Route119_WeatherInstitute_2F_EventScript_CreateAbnormalWeather
	specialvar VAR_RESULT, GetAbnormalWeatherMapNameAndType
	goto_if_eq VAR_RESULT, 1, Route119_WeatherInstitute_2F_EventScript_KyogreWeather
	msgbox Route119_WeatherInstitute_2F_Text_GroudonWeather, MSGBOX_DEFAULT
	release
	end

Route119_WeatherInstitute_2F_EventScript_KyogreWeather::
	msgbox Route119_WeatherInstitute_2F_Text_KyogreWeather, MSGBOX_DEFAULT
	release
	end

Route119_WeatherInstitute_2F_EventScript_CreateAbnormalWeather::
	special CreateAbnormalWeatherEvent
	setflag FLAG_TEMP_2
	return

Route119_WeatherInstitute_2F_EventScript_LegendaryDefeated::
	addvar VAR_0x8004, 1
	return

Route119_WeatherInstitute_2F_EventScript_NoAbnormalWeather::
	msgbox Route119_WeatherInstitute_2F_Text_NoAbnormalWeather, MSGBOX_DEFAULT
	release
	end

Route119_WeatherInstitute_2F_Movement_GruntApproachShelly:
	walk_fast_left
	walk_fast_left
	walk_fast_left
	walk_fast_left
	walk_fast_left
	walk_fast_left
	walk_fast_left
	walk_fast_left
	walk_fast_left
	walk_fast_left
	walk_fast_left
	step_end

Route119_WeatherInstitute_2F_Movement_ShovePlayerOutOfWay:
	delay_16
	delay_16
	delay_16
	delay_16
	delay_16
	ride_water_current_up
	walk_in_place_faster_down
	step_end

Route119_WeatherInstitute_2F_Movement_PlayerReturnToPosition:
	slide_down
	walk_in_place_faster_left
	step_end

Route119_WeatherInstitute_2F_Movement_ScientistApproachPlayer:
	walk_right
	walk_right
	walk_right
	step_end

Route119_WeatherInstitute_2F_EventScript_WeatherScientist::
	lock
	faceplayer
	goto(Route119_WeatherInstitute_2F_EventScript_ScientistMentionWeather)
	end

Route119_WeatherInstitute_2F_Text_Grunt2Intro:
	.string "The INSTITUTE created a type of\n"
	.string "POKéMON that has something to do with\l"
	.string "the weather. We're here to take them!$"

Route119_WeatherInstitute_2F_Text_Grunt2Defeat:
	.string "Our plan's being spoiled by a kid?$"

Route119_WeatherInstitute_2F_Text_Grunt2PostBattle:
	.string "If the POKéMON they made here can\n"
	.string "control the weather freely, then we of\l"
	.string "TEAM AQUA definitely need it!$"

Route119_WeatherInstitute_2F_Text_Grunt3Intro:
	.string "We're TEAM AQUA!\n"
	.string "We appear wherever anything rare is\l"
	.string "found!$"

Route119_WeatherInstitute_2F_Text_Grunt3Defeat:
	.string "You got me!$"

Route119_WeatherInstitute_2F_Text_Grunt3PostBattle:
	.string "You don't have any idea what we of\n"
	.string "TEAM AQUA are working towards!\l"
	.string "You stay out of our way!$"

Route119_WeatherInstitute_2F_Text_Grunt5Intro:
	.string "Don't tell me you're looking for that\n"
	.string "weather POKéMON, too?\p"
	.string "That's a no-no!\n"
	.string "We were here to get it first!$"

Route119_WeatherInstitute_2F_Text_Grunt5Defeat:
	.string "Oh, will you look at my POKéMON?$"

Route119_WeatherInstitute_2F_Text_Grunt5PostBattle:
	.string "Humph, so what?\n"
	.string "What we want…\p"
	.string "What we really want isn't here…\n"
	.string "Ihihihihi…$"

Route119_WeatherInstitute_2F_Text_ShellyIntro:
	.string "Ahahahaha!\p"
	.string "You're going to meddle in TEAM AQUA's\n"
	.string "affairs?\p"
	.string "You're either absolutely fearless,\n"
	.string "simply ignorant, or both!\p"
	.string "You're so cute, you're disgusting!\n"
	.string "I'll put you down, kiddy!$"

Route119_WeatherInstitute_2F_Text_ShellyDefeat:
	.string "Ahahahaha!\n"
	.string "You're disgustingly strong!$"

Route119_WeatherInstitute_2F_Text_ShellyPostBattle:
	.string "It's bad enough to have TEAM MAGMA\n"
	.string "blunder about, but now there's you!\p"
	.string "What makes you want to sniff around\n"
	.string "in our business, anyway?$"

Route119_WeatherInstitute_2F_Text_TeamMagmaJustPassedBy:
	.string "We have a situation here!\p"
	.string "A TEAM MAGMA mob just passed\n"
	.string "the WEATHER INSTITUTE.\p"
	.string "They appear to be headed for\n"
	.string "MT. PYRE!$"

Route119_WeatherInstitute_2F_Text_WeHaveToHurryToMtPyre:
	.string "What?!\p"
	.string "We can't waste any more time here!\n"
	.string "We have to hurry to MT. PYRE, too!\p"
	.string "Ahahahaha!\n"
	.string "TEAM MAGMA, just you wait!$"

Route119_WeatherInstitute_2F_Text_ThanksPleaseTakePokemon:
	.string "Thanks!\n"
	.string "Thanks to you, we're safe!\p"
	.string "It might be an odd way of thanking you,\n"
	.string "but take this POKéMON.$"

Route119_WeatherInstitute_2F_Text_ChangingWeatherRidiculous:
	.string "I've been researching rain for many\n"
	.string "years, but it's ridiculous to think that\l"
	.string "humans can freely change the weather.$"

Route119_WeatherInstitute_2F_Text_GroudonWeather:
	.string "I track weather patterns over\n"
	.string "the HOENN region.\p"
	.string "Presently, a drought has been recorded\n"
	.string "in {STR_VAR_1}.\p"
	.string "Could that mean, somewhere near\n"
	.string "{STR_VAR_1}…$"

Route119_WeatherInstitute_2F_Text_KyogreWeather:
	.string "I track weather patterns over\n"
	.string "the HOENN region.\p"
	.string "Presently, heavy rainfall has been\n"
	.string "recorded over {STR_VAR_1}.\p"
	.string "Could that mean, somewhere near\n"
	.string "{STR_VAR_1}…$"

Route119_WeatherInstitute_2F_Text_NoAbnormalWeather:
	.string "Abnormal weather conditions are\n"
	.string "no longer being reported.\p"
	.string "The occasional rainfall is a blessing,\n"
	.string "really.$"
`

const LOCALID_SCIENTIST = 1
const LOCALID_ARCHIE = 2
const LOCALID_MAXIE = 3
const LOCALID_VERDANTURF_CASTFORM = 4
const FLAG_TEMP_HIDE_MAXIE = FLAG_TEMP_4

const FLAG_TEMP_HIDE_ROUTE120_RESEARCHER = FLAG_TEMP_5
const FLAG_TEMP_HIDE_VERDANTURF_RESEARCHER = FLAG_TEMP_6
const FLAG_TEMP_HIDE_SOOTOPOLIS_RESEARCHER = FLAG_TEMP_7


script Route119_WeatherInstitute_2F_OnTransition {
	if (!flag(FLAG_DELIVERED_MAYS_PACKAGE)) {
		call(Route119_WeatherInstitute_2F_EventScript_SetupArchieMaxieScene)
	}
	else {
		setflag(FLAG_TEMP_HIDE_MAXIE)
	}
	call(Route119_WeatherInstitute_2F_EventScript_SetupFieldResearchers)
	end
}

script Route119_WeatherInstitute_2F_EventScript_SetupFieldResearchers {
	if (!flag(FLAG_FOUND_ROUTE120_RESEARCHER)) {
		setflag(FLAG_TEMP_HIDE_ROUTE120_RESEARCHER)
	}
	if (!flag(FLAG_FOUND_VERDANTURF_RESEARCHER)) {
		setflag(FLAG_TEMP_HIDE_VERDANTURF_RESEARCHER)
	}
	if (!flag(FLAG_FOUND_SOOTOPOLIS_RESEARCHER)) {
		setflag(FLAG_TEMP_HIDE_SOOTOPOLIS_RESEARCHER)
	}
}

script Route119_WeatherInstitute_2F_EventScript_SetupArchieMaxieScene {
	setobjectxyperm(LOCALID_ARCHIE, 14, 6)
	return
}

script Route119_WeatherInstitute_2F_EventScript_Archie {
	if (!flag(FLAG_DELIVERED_MAYS_PACKAGE)) {
		goto(Route119_WeatherInstitute_2F_EventScript_ArchieDeliverPackage)
	}
	lock
	faceplayer
	speakername(CommonName_Archie)
	checkplayergender
	if (var(VAR_RESULT) == MALE) {
		bufferstring(STR_VAR_1, "boy")
	}
	else {
		bufferstring(STR_VAR_1, "girl")
	}
	msgbox(format("Hm?\nOh, the errand {STR_VAR_1}.\p"
		"Yes, I used to be the leader of Team Aqua.\p"
		"I have done some bad things in the past, now it's my responsibility to fix that."))
	closemessage
	turnobject(LOCALID_ARCHIE, DIR_NORTH)
	release
	end
}

script Route119_WeatherInstitute_2F_EventScript_ArchieDeliverPackage {
	lock
	faceplayer
	speakername(CommonName_Archie)
	msgbox(format("Hm?\nAnd who might you be?\p"
		"…\p"
		"{PLAYER}? And you have something to deliver? From Lavaridge Town's Gym Leader?\p"
		"Let me see…"), MSGBOX_DEFAULT)
	closemessage
	delay(36)
	applymovement(LOCALID_ARCHIE, Common_Movement_WalkInPlaceLeft)
	waitmovement(0)
	msgbox(format("Maxie!\n Here's more work for you!\pYour minions are stirring up trouble again!"))
	closemessage
	applymovement(LOCALID_ARCHIE, Route119_WeatherInstitute_2F_ArchieReturnToWorkplace)
	delay(30)
	speakername(CommonName_Maxie)
	msgbox(format("For the last time Archie, stop calling them my minions!\pYou don't have any control over what's left of Team Aqua either!"))
	closemessage
	waitmovement(0)
	applymovement(LOCALID_MAXIE, Route119_WeatherInstitute_2F_MaxieApproachPlayer)
	waitmovement(0)
	msgbox(format("So, what do you have for me?"))
	closemessage
	applymovement(OBJ_EVENT_ID_PLAYER, Common_Movement_WalkInPlaceLeft)
	waitmovement(0)
	speakername(NULL)
	setvar(VAR_0x8004, ITEM_MAYS_PACKAGE)
	call(Common_EventScript_PlayerHandedOverTheItem)
	speakername(CommonName_Maxie)
	msgbox(format("…\pThat's… not good.\pWould you mind letting me through?"))
	closemessage
	applymovement(OBJ_EVENT_ID_PLAYER, Route119_WeatherInstitute_2F_PlayerMakeRoom)
	applymovement(LOCALID_MAXIE, Route119_WeatherInstitute_2F_MaxieLeave)
	waitmovement(LOCALID_MAXIE)
	playse(SE_FU_ZAKU)
	removeobject(LOCALID_MAXIE)
	waitse
	setobjectxyperm(LOCALID_ARCHIE, 2, 2)
	removeobject(LOCALID_ARCHIE)
	addobject(LOCALID_ARCHIE)
	setflag(FLAG_HIDE_ROUTE_119_CASTFORM_SCIENTIST)
	setflag(FLAG_DELIVERED_MAYS_PACKAGE)
	release
	end
}

script Route119_WeatherInstitute_2F_EventScript_Route120FieldResearcher{
	lock
	msgbox(format("Hmmm, the amount of rain on Route 120 over the past year is…\pYes, that sounds about right…"))
	closemessage
	release
	end
}

script Route119_WeatherInstitute_2F_EventScript_VerdanturfFieldResearcher{
	lock
	speakername("Trevor")
	msgbox(format("You're so high up, Bubbles!"))
	closemessage
	applymovement(LOCALID_VERDANTURF_CASTFORM, Common_Movement_JumpInPlaceDown)
	waitmovement(0)
	speakername("Bubbles")
	playmoncry(SPECIES_CASTFORM, CRY_MODE_NORMAL)
	msgbox(Common_Text_Castform_Cry)
	closemessage
	waitmoncry
	release
	end
}

script Route119_WeatherInstitute_2F_EventScript_SootopolisFieldResearcher{
	lock
	speakername("Silvia")
	msgbox(format("Ah, that trip to Sootopolis City was like a vacation…\p"
		"Why does the institute have to be in such a perpetually rainy place?"))
	closemessage
	release
	end
}

script Route119_WeatherInstitute_2F_EventScript_ExpositionManiac {
	lock
	faceplayer
	speakername("Florent")
	msgbox(format("There's so much to do…\p"
		"After Groudon and Kyogre woke up, the climate went wild all over the region.\p"
		"We're doing our best to predict abnormal weather events with Castform's help."))
	closemessage
	release
	end
}

movement Route119_WeatherInstitute_2F_ArchieApproachPlayer {
	walk_right * 7
}

movement Route119_WeatherInstitute_2F_ArchieReturnToWorkplace {
	walk_left * 8
}

movement Route119_WeatherInstitute_2F_MaxieApproachPlayer {
	walk_fast_up *2
	walk_right * 7
}

movement Route119_WeatherInstitute_2F_PlayerMakeRoom {
	walk_up
	face_down
	delay_16*4
	face_right
}

movement Route119_WeatherInstitute_2F_MaxieLeave {
	delay_8
	walk_right *3
	walk_up *5
}

